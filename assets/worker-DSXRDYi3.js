let r;function j(n,t){if(!(n instanceof t))throw new Error(`expected instance of ${t.name}`)}function W(n,t){return n=n>>>0,p().subarray(n/1,n/1+t)}function c(n,t){return n=n>>>0,P(n,t)}let x=null;function p(){return(x===null||x.byteLength===0)&&(x=new Uint8Array(r.memory.buffer)),x}function w(n){return n==null}function v(n,t){const e=t(n.length*1,1)>>>0;return p().set(n,e/1),o=n.length,e}function g(n,t,e){if(e===void 0){const a=A.encode(n),l=t(a.length,1)>>>0;return p().subarray(l,l+a.length).set(a),o=a.length,l}let _=n.length,s=t(_,1)>>>0;const h=p();let i=0;for(;i<_;i++){const a=n.charCodeAt(i);if(a>127)break;h[s+i]=a}if(i!==_){i!==0&&(n=n.slice(i)),s=e(s,_,_=i+n.length*3,1)>>>0;const a=p().subarray(s+i,s+_),l=A.encodeInto(n,a);i+=l.written,s=e(s,_,i,1)>>>0}return o=i,s}function u(n){const t=r.__wbindgen_externrefs.get(n);return r.__externref_table_dealloc(n),t}let I=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0});I.decode();const U=2146435072;let C=0;function P(n,t){return C+=t,C>=U&&(I=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0}),I.decode(),C=t),I.decode(p().subarray(n,n+t))}const A=new TextEncoder;"encodeInto"in A||(A.encodeInto=function(n,t){const e=A.encode(n);return t.set(e),{read:n.length,written:e.length}});let o=0;const S=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(n=>r.__wbg_albumcovermetadatum_free(n>>>0,1)),E=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(n=>r.__wbg_commentmetadatum_free(n>>>0,1)),B=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(n=>r.__wbg_extendedtextmetadatum_free(n>>>0,1)),D=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(n=>r.__wbg_metadata_free(n>>>0,1)),F=typeof FinalizationRegistry>"u"?{register:()=>{},unregister:()=>{}}:new FinalizationRegistry(n=>r.__wbg_tagcontroller_free(n>>>0,1));class m{static __wrap(t){t=t>>>0;const e=Object.create(m.prototype);return e.__wbg_ptr=t,S.register(e,e.__wbg_ptr,e),e}__destroy_into_raw(){const t=this.__wbg_ptr;return this.__wbg_ptr=0,S.unregister(this),t}free(){const t=this.__destroy_into_raw();r.__wbg_albumcovermetadatum_free(t,0)}get data(){return r.albumcovermetadatum_data(this.__wbg_ptr)}get mimeType(){let t,e;try{const _=r.albumcovermetadatum_mimeType(this.__wbg_ptr);return t=_[0],e=_[1],c(_[0],_[1])}finally{r.__wbindgen_free(t,e,1)}}}Symbol.dispose&&(m.prototype[Symbol.dispose]=m.prototype.free);class f{static __wrap(t){t=t>>>0;const e=Object.create(f.prototype);return e.__wbg_ptr=t,E.register(e,e.__wbg_ptr,e),e}__destroy_into_raw(){const t=this.__wbg_ptr;return this.__wbg_ptr=0,E.unregister(this),t}free(){const t=this.__destroy_into_raw();r.__wbg_commentmetadatum_free(t,0)}get description(){let t,e;try{const _=r.commentmetadatum_description(this.__wbg_ptr);return t=_[0],e=_[1],c(_[0],_[1])}finally{r.__wbindgen_free(t,e,1)}}get lang(){let t,e;try{const _=r.commentmetadatum_lang(this.__wbg_ptr);return t=_[0],e=_[1],c(_[0],_[1])}finally{r.__wbindgen_free(t,e,1)}}get text(){let t,e;try{const _=r.commentmetadatum_text(this.__wbg_ptr);return t=_[0],e=_[1],c(_[0],_[1])}finally{r.__wbindgen_free(t,e,1)}}}Symbol.dispose&&(f.prototype[Symbol.dispose]=f.prototype.free);class R{__destroy_into_raw(){const t=this.__wbg_ptr;return this.__wbg_ptr=0,B.unregister(this),t}free(){const t=this.__destroy_into_raw();r.__wbg_extendedtextmetadatum_free(t,0)}get description(){let t,e;try{const _=r.extendedtextmetadatum_description(this.__wbg_ptr);return t=_[0],e=_[1],c(_[0],_[1])}finally{r.__wbindgen_free(t,e,1)}}get value(){let t,e;try{const _=r.extendedtextmetadatum_value(this.__wbg_ptr);return t=_[0],e=_[1],c(_[0],_[1])}finally{r.__wbindgen_free(t,e,1)}}}Symbol.dispose&&(R.prototype[Symbol.dispose]=R.prototype.free);class y{static __wrap(t){t=t>>>0;const e=Object.create(y.prototype);return e.__wbg_ptr=t,D.register(e,e.__wbg_ptr,e),e}__destroy_into_raw(){const t=this.__wbg_ptr;return this.__wbg_ptr=0,D.unregister(this),t}free(){const t=this.__destroy_into_raw();r.__wbg_metadata_free(t,0)}get trackIndex(){const t=r.__wbg_get_metadata_trackIndex(this.__wbg_ptr);return t===4294967297?void 0:t}set trackIndex(t){r.__wbg_set_metadata_trackIndex(this.__wbg_ptr,w(t)?4294967297:t>>>0)}get trackCount(){const t=r.__wbg_get_metadata_trackCount(this.__wbg_ptr);return t===4294967297?void 0:t}set trackCount(t){r.__wbg_set_metadata_trackCount(this.__wbg_ptr,w(t)?4294967297:t>>>0)}get discIndex(){const t=r.__wbg_get_metadata_discIndex(this.__wbg_ptr);return t===4294967297?void 0:t}set discIndex(t){r.__wbg_set_metadata_discIndex(this.__wbg_ptr,w(t)?4294967297:t>>>0)}get discCount(){const t=r.__wbg_get_metadata_discCount(this.__wbg_ptr);return t===4294967297?void 0:t}set discCount(t){r.__wbg_set_metadata_discCount(this.__wbg_ptr,w(t)?4294967297:t>>>0)}get year(){const t=r.__wbg_get_metadata_year(this.__wbg_ptr);return t===4294967297?void 0:t}set year(t){r.__wbg_set_metadata_year(this.__wbg_ptr,w(t)?4294967297:t>>0)}get duration(){const t=r.__wbg_get_metadata_duration(this.__wbg_ptr);return t===4294967297?void 0:t}set duration(t){r.__wbg_set_metadata_duration(this.__wbg_ptr,w(t)?4294967297:t>>>0)}get albumCover(){const t=r.metadata_albumCover(this.__wbg_ptr);return t===0?void 0:m.__wrap(t)}get albumArtist(){const t=r.metadata_albumArtist(this.__wbg_ptr);let e;return t[0]!==0&&(e=c(t[0],t[1]).slice(),r.__wbindgen_free(t[0],t[1]*1,1)),e}get dateRecorded(){const t=r.metadata_dateRecorded(this.__wbg_ptr);let e;return t[0]!==0&&(e=c(t[0],t[1]).slice(),r.__wbindgen_free(t[0],t[1]*1,1)),e}get dateReleased(){const t=r.metadata_dateReleased(this.__wbg_ptr);let e;return t[0]!==0&&(e=c(t[0],t[1]).slice(),r.__wbindgen_free(t[0],t[1]*1,1)),e}get album(){const t=r.metadata_album(this.__wbg_ptr);let e;return t[0]!==0&&(e=c(t[0],t[1]).slice(),r.__wbindgen_free(t[0],t[1]*1,1)),e}get genre(){const t=r.metadata_genre(this.__wbg_ptr);let e;return t[0]!==0&&(e=c(t[0],t[1]).slice(),r.__wbindgen_free(t[0],t[1]*1,1)),e}get title(){const t=r.metadata_title(this.__wbg_ptr);let e;return t[0]!==0&&(e=c(t[0],t[1]).slice(),r.__wbindgen_free(t[0],t[1]*1,1)),e}get artist(){const t=r.metadata_artist(this.__wbg_ptr);let e;return t[0]!==0&&(e=c(t[0],t[1]).slice(),r.__wbindgen_free(t[0],t[1]*1,1)),e}get lyrics(){return r.metadata_lyrics(this.__wbg_ptr)}get comments(){return r.metadata_comments(this.__wbg_ptr)}get publisher(){const t=r.metadata_publisher(this.__wbg_ptr);let e;return t[0]!==0&&(e=c(t[0],t[1]).slice(),r.__wbindgen_free(t[0],t[1]*1,1)),e}}Symbol.dispose&&(y.prototype[Symbol.dispose]=y.prototype.free);class d{static __wrap(t){t=t>>>0;const e=Object.create(d.prototype);return e.__wbg_ptr=t,F.register(e,e.__wbg_ptr,e),e}__destroy_into_raw(){const t=this.__wbg_ptr;return this.__wbg_ptr=0,F.unregister(this),t}free(){const t=this.__destroy_into_raw();r.__wbg_tagcontroller_free(t,0)}addLyrics(t){j(t,f);var e=t.__destroy_into_raw();r.tagcontroller_addLyrics(this.__wbg_ptr,e)}setArtist(t){const e=g(t,r.__wbindgen_malloc,r.__wbindgen_realloc),_=o;r.tagcontroller_setArtist(this.__wbg_ptr,e,_)}removeYear(){r.tagcontroller_removeYear(this.__wbg_ptr)}static fromPartial(t,e){const _=v(t,r.__wbindgen_malloc),s=o;var h=w(e)?0:v(e,r.__wbindgen_malloc),i=o;const a=r.tagcontroller_fromPartial(_,s,h,i);if(a[2])throw u(a[1]);return d.__wrap(a[0])}getMetadata(){const t=r.tagcontroller_getMetadata(this.__wbg_ptr);return y.__wrap(t)}putTagInto(t){const e=v(t,r.__wbindgen_malloc),_=o,s=r.tagcontroller_putTagInto(this.__wbg_ptr,e,_);if(s[2])throw u(s[1]);return u(s[0])}removeAlbum(){r.tagcontroller_removeAlbum(this.__wbg_ptr)}removeGenre(){r.tagcontroller_removeGenre(this.__wbg_ptr)}removeTitle(){r.tagcontroller_removeTitle(this.__wbg_ptr)}setDuration(t){r.tagcontroller_setDuration(this.__wbg_ptr,t)}removeArtist(){r.tagcontroller_removeArtist(this.__wbg_ptr)}setPublisher(t){const e=g(t,r.__wbindgen_malloc,r.__wbindgen_realloc),_=o;r.tagcontroller_setPublisher(this.__wbg_ptr,e,_)}setDiscCount(t){r.tagcontroller_setDiscCount(this.__wbg_ptr,t)}setDiscIndex(t){r.tagcontroller_setDiscIndex(this.__wbg_ptr,t)}setTrackCount(t){r.tagcontroller_setTrackCount(this.__wbg_ptr,t)}setTrackIndex(t){r.tagcontroller_setTrackIndex(this.__wbg_ptr,t)}setAlbumArtist(t){const e=g(t,r.__wbindgen_malloc,r.__wbindgen_realloc),_=o;r.tagcontroller_setAlbumArtist(this.__wbg_ptr,e,_)}removeDiscCount(){r.tagcontroller_removeDiscCount(this.__wbg_ptr)}removeDiscIndex(){r.tagcontroller_removeDiscIndex(this.__wbg_ptr)}setDateRecorded(t){const e=g(t,r.__wbindgen_malloc,r.__wbindgen_realloc),_=o,s=r.tagcontroller_setDateRecorded(this.__wbg_ptr,e,_);if(s[1])throw u(s[0])}setDateReleased(t){const e=g(t,r.__wbindgen_malloc,r.__wbindgen_realloc),_=o,s=r.tagcontroller_setDateReleased(this.__wbg_ptr,e,_);if(s[1])throw u(s[0])}removeTrackCount(){r.tagcontroller_removeTrackCount(this.__wbg_ptr)}removeTrackIndex(){r.tagcontroller_removeTrackIndex(this.__wbg_ptr)}removeAlbumArtist(){r.tagcontroller_removeAlbumArtist(this.__wbg_ptr)}static new(){const t=r.tagcontroller_new();return d.__wrap(t)}static from(t){const e=v(t,r.__wbindgen_malloc),_=o,s=r.tagcontroller_from(e,_);if(s[2])throw u(s[1]);return d.__wrap(s[0])}setYear(t){r.tagcontroller_setYear(this.__wbg_ptr,t)}setAlbum(t){const e=g(t,r.__wbindgen_malloc,r.__wbindgen_realloc),_=o;r.tagcontroller_setAlbum(this.__wbg_ptr,e,_)}setGenre(t){const e=g(t,r.__wbindgen_malloc,r.__wbindgen_realloc),_=o;r.tagcontroller_setGenre(this.__wbg_ptr,e,_)}setTitle(t){const e=g(t,r.__wbindgen_malloc,r.__wbindgen_realloc),_=o;r.tagcontroller_setTitle(this.__wbg_ptr,e,_)}}Symbol.dispose&&(d.prototype[Symbol.dispose]=d.prototype.free);function L(n){const t=v(n,r.__wbindgen_malloc),e=o;return r.hasId3v2Tag(t,e)!==0}const N=new Set(["basic","cors","default"]);async function Y(n,t){if(typeof Response=="function"&&n instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(n,t)}catch(_){if(n.ok&&N.has(n.type)&&n.headers.get("Content-Type")!=="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve Wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",_);else throw _}const e=await n.arrayBuffer();return await WebAssembly.instantiate(e,t)}else{const e=await WebAssembly.instantiate(n,t);return e instanceof WebAssembly.Instance?{instance:e,module:n}:e}}function k(){const n={};return n.wbg={},n.wbg.__wbg___wbindgen_throw_dd24417ed36fc46e=function(t,e){throw new Error(c(t,e))},n.wbg.__wbg_commentmetadatum_new=function(t){return f.__wrap(t)},n.wbg.__wbg_new_25f239778d6112b9=function(){return new Array},n.wbg.__wbg_new_df1173567d5ff028=function(t,e){return new Error(c(t,e))},n.wbg.__wbg_new_from_slice_f9c22b9153b26992=function(t,e){return new Uint8Array(W(t,e))},n.wbg.__wbg_push_7d9be8f38fc13975=function(t,e){return t.push(e)},n.wbg.__wbindgen_init_externref_table=function(){const t=r.__wbindgen_externrefs,e=t.grow(4);t.set(0,void 0),t.set(e+0,void 0),t.set(e+1,null),t.set(e+2,!0),t.set(e+3,!1)},n}function z(n,t){return r=n.exports,M.__wbindgen_wasm_module=t,x=null,r.__wbindgen_start(),r}function $(n){if(r!==void 0)return r;typeof n<"u"&&(Object.getPrototypeOf(n)===Object.prototype?{module:n}=n:console.warn("using deprecated parameters for `initSync()`; pass a single object instead"));const t=k();n instanceof WebAssembly.Module||(n=new WebAssembly.Module(n));const e=new WebAssembly.Instance(n,t);return z(e,n)}async function M(n){if(r!==void 0)return r;typeof n<"u"&&(Object.getPrototypeOf(n)===Object.prototype?{module_or_path:n}=n:console.warn("using deprecated parameters for the initialization function; pass a single object instead")),typeof n>"u"&&(n=new URL("/id3-wasm/assets/id3_wasm_bg-BgNhUjIy.wasm",import.meta.url));const t=k();(typeof n=="string"||typeof Request=="function"&&n instanceof Request||typeof URL=="function"&&n instanceof URL)&&(n=fetch(n));const{instance:e,module:_}=await Y(await n,t);return z(e,_)}var G=Object.freeze({__proto__:null,AlbumCoverMetadatum:m,CommentMetadatum:f,ExtendedTextMetadatum:R,Metadata:y,TagController:d,default:M,hasId3v2Tag:L,initSync:$});(async()=>(await M(),self.onmessage=async n=>{const{type:t,payload:e}=n.data;if(t==="process"){const{file:_,HEAD_CHUNK_SIZE:s}=e,{TagController:h,hasId3v2Tag:i}=G;try{const a=new Uint8Array(await _.slice(0,s).arrayBuffer());let l;i(a)||(l=_.size>=128?new Uint8Array(await _.slice(_.size-128).arrayBuffer()):null);let T;try{T=h.fromPartial(a,l);const b=T.getMetadata(),O={title:b.title||"",artist:b.artist||"",album:b.album||"",year:b.year||"",genre:b.genre||""};self.postMessage({type:"result",payload:{metadata:O,fileName:_.name}})}catch(b){self.postMessage({type:"error",payload:{message:`Error processing ${_.name}: ${b.message}`,fileName:_.name}})}finally{T&&T.free()}}catch(a){self.postMessage({type:"error",payload:{message:`Failed to process file ${_.name}: ${a.message}`,fileName:_.name}})}}},self.postMessage({type:"ready"})))();
