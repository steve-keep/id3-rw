(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))u(e);new MutationObserver(e=>{for(const t of e)if(t.type==="childList")for(const n of t.addedNodes)n.tagName==="LINK"&&n.rel==="modulepreload"&&u(n)}).observe(document,{childList:!0,subtree:!0});function d(e){const t={};return e.integrity&&(t.integrity=e.integrity),e.referrerPolicy&&(t.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?t.credentials="include":e.crossOrigin==="anonymous"?t.credentials="omit":t.credentials="same-origin",t}function u(e){if(e.ep)return;e.ep=!0;const t=d(e);fetch(e.href,t)}})();const L="/id3-wasm/assets/id3_rw_bg-C1FiBZcf.wasm";console.log("Wasm module loaded");const O=document.getElementById("start-button"),l=document.getElementById("timing-output"),S=document.getElementById("worker-count-output"),F=document.querySelector("#metadata-table tbody");O.addEventListener("click",async()=>{if(!window.showDirectoryPicker){alert("File System Access API is not supported in this browser.");return}try{const i=await window.showDirectoryPicker();l.textContent="Collecting files...",F.innerHTML="";const r=[];for await(const s of i.values())s.kind==="file"&&s.name.endsWith(".mp3")&&r.push(await s.getFile());const d=navigator.hardwareConcurrency||4;S.textContent=`Using ${d} workers.`,l.textContent="Starting processing...";const u=performance.now();let e=0,t=0;const n=[...r],g=[];await new Promise(s=>{const w=()=>{t--,t===0&&n.length===0&&s()},p=m=>{if(n.length>0){const o=n.shift();t++,m.postMessage({type:"process",payload:{file:o,HEAD_CHUNK_SIZE:4096}})}};for(let m=0;m<d;m++){const o=new Worker(new URL("/id3-wasm/assets/worker-CXseMu4z.js",import.meta.url));g.push(o),o.postMessage({type:"init",payload:{module:L}}),o.onmessage=f=>{const{type:y,payload:C}=f.data;if(y==="ready"){p(o);return}if(e++,y==="result"){const{metadata:a}=C,c=document.createElement("tr"),h=document.createElement("td");h.textContent=a.title,c.appendChild(h);const E=document.createElement("td");E.textContent=a.artist,c.appendChild(E);const x=document.createElement("td");x.textContent=a.album,c.appendChild(x);const b=document.createElement("td");b.textContent=a.year,c.appendChild(b);const k=document.createElement("td");k.textContent=a.genre,c.appendChild(k),F.appendChild(c)}else y==="error"&&console.error(C);l.textContent=`Scanning... Processed ${e} of ${r.length} files.`,w(),p(o)},o.onerror=f=>{console.error("Worker error:",f),e++,w(),p(o)}}}),g.forEach(s=>s.terminate());const P=(performance.now()-u)/1e3;l.textContent=`Scanned ${r.length} files in ${P.toFixed(2)} seconds.`}catch(i){i.name!=="AbortError"&&(console.error("Error selecting directory:",i),l.textContent=`Error: ${i.message}`)}});
